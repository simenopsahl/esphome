# for horizontal 240x320 displays

font: !include
  file: fonts/fonts.yaml
  vars:
    text_sm: 14
    text_md: 18
    text_lg: 22
    text_xl: 26
    text_xxl: 30
    text_hg: 56
    text_fl: 112
    icons_sm: 18
    icons_md: 24
    icons_lg: 32
    icons_xl: 40
    icons_xxl: 48

.sizing:
  - &nav_widget_vars
    height: 34
    padding: 12

  - &page_styles
    <<: !include styles/page_styles.yaml
    page_pad_top: 34
    page_pad_bottom: 34

  - &clock_page_styles
    meter_height: 170
    meter_width: 170

  - &container_styles
    <<: !include styles/container_styles.yaml
    container_pad_top: 0
    container_pad_bottom: 0
    container_pad_left: 4
    container_pad_right: 4
    container_scrollable: false # prevents scrollbars on pages where space is used up to the last pixel

  - &button_layout
    <<: !include styles/button_layout.yaml
    pad_column: 5
    pad_row: 4

  - &nordpool_layout_vars
    # -- DISPLAY CONFIGURATION --
    screen_width: 320
    screen_height: 240

    # -- LAYOUT CONFIGURATION --
    # Height of the status bar area at the top and navigation at the bottom
    status_bar_height: 34
    # Proportions for the 3 rows in the grid layout (labels, graph, labels)
    grid_row_top_fr: 18
    grid_row_graph_fr: 136
    grid_row_bottom_fr: 14

    # -- GRAPH CONFIGURATION --
    line_width: 4

  - &button_widget_vars
    width: 75
    height: 114

  - &wide_button_widget_vars
    width: 232
    height: 75

# Styles for Weather forcast
.forcast_styles:
    - &forcast_obj_base
      height: SIZE_CONTENT
      width: SIZE_CONTENT
      bg_color: c_black
      radius: 3
      pad_top: 0
      pad_bottom : 0
      layout:
        type: flex
        flex_flow: COLUMN
        flex_align_cross: center
        flex_align_track: center
        pad_column: 0
        pad_row: 0

    - &forcast_label_base
      text_font: font_md
      height: SIZE_CONTENT

    - &forcast_label_base_sm
      height: SIZE_CONTENT
      text_font: font_sm
      text_color: c_text_s

    - &forcast_image_base
      height: SIZE_CONTENT

script:
  - id: go_home
    then:
      - lvgl.page.show: ${home_page}

lvgl:
  default_font: font_md
  theme: !include themes/main.yaml
  disp_bg_color: 0x000000
  bg_color: 0x000000
  top_layer:
    widgets:
      - <<: !include { file: widgets/header/widget.yaml, vars: { <<: *nav_widget_vars } }
      - <<: !include { file: widgets/footer/widget.yaml, vars: { <<: *nav_widget_vars } }
      - <<: !include { file: widgets/boot_screen/widget.yaml }
  pages:
    - id: page_splash
      skip: true
      on_load:
        - script.execute: go_home

    # analog clock
    - <<: !include { file: pages/clock/page.yaml, vars: { <<: [*page_styles, *container_styles, *clock_page_styles] } }

    # device status
    - <<: !include { file: pages/status/page.yaml, vars: { <<: [*page_styles, *container_styles] } }

    # room temperature
    - <<: !include { file: pages/temperature/page.yaml, vars: { <<: [*page_styles, *container_styles] } }

    # weather forecast
    - id: page_weather
      # REMOVED: `<<: *page_styles`
      # ADDED: Use the variables passed from the parent file
      pad_top: !lambda return page_pad_top;
      pad_bottom: !lambda return page_pad_bottom;
      on_load:
        - lvgl.label.update:
            id: page_title
            text: Vær
      <<: !include
        file: functions/swipe_navigation.yaml
      widgets:
        - obj:
            pad_all: 1
            height: 100%
            width: 100%
            align: CENTER
            layout:
              type: GRID
              grid_rows: [ fr(3), fr(4) ]
              grid_columns: [ fr(1), fr(1) ]
            widgets:
              - image:
                  height: SIZE_CONTENT
                  width: SIZE_CONTENT
                  grid_cell_row_pos: 0
                  grid_cell_column_pos: 0
                  grid_cell_y_align: CENTER
                  grid_cell_x_align: CENTER
                  align: CENTER
                  src: unknown_60
                  id: weather_condition_icon
#                  widgets:
#                    - image:
#                        src: unknown_60
#                        id: weather_condition_icon
              - obj:
                  grid_cell_row_pos: 0
                  grid_cell_column_pos: 1
                  grid_cell_y_align: CENTER
                  bg_opa: TRANSP
                  layout:
                    type: FLEX
                    flex_flow: COLUMN
                    flex_align_main: CENTER
                    flex_align_cross: START
                  widgets:
                    - label:
                        text: "--°"
                        id: weather_temperature_today
                        text_font: font_xl
                        text_align: LEFT
                    - label:
                        text: "Været nå"
                        id: weather_condition_today
                        long_mode: wrap
                        scrollable: true
                        text_font: font_md
                        text_align: LEFT

              - obj:
                  width: 100%
                  height: SIZE_CONTENT
                  grid_cell_row_pos: 1
                  grid_cell_column_pos: 0
                  grid_cell_column_span: 2
                  grid_cell_y_align: CENTER
                  grid_cell_x_align: STRETCH
                  layout:
                    type: GRID
                    grid_rows: [ content ]
                    grid_columns: [ 70, 70, 70, 70 ]
                    pad_column: 6
                    pad_row: 0
                  widgets:
                      - obj:
                          <<: *forcast_obj_base
                          grid_cell_row_pos: 0
                          grid_cell_column_pos: 0
                          widgets:
                              - label:
                                  id: forecast_timestamp_0
                                  <<: *forcast_label_base_sm
                                  text: ???
                              - image:
                                  id: forecast_condition_icon_0
                                  <<: *forcast_image_base
                                  src: unknown_34
                              - label:
                                  id: forecast_temperature_0
                                  <<: *forcast_label_base
                                  text: "--°"
                      - obj:
                          <<: *forcast_obj_base
                          grid_cell_row_pos: 0
                          grid_cell_column_pos: 1
                          widgets:
                              - label:
                                  id: forecast_timestamp_1
                                  <<: *forcast_label_base_sm
                                  text: ???
                              - image:
                                  id: forecast_condition_icon_1
                                  <<: *forcast_image_base
                                  src: unknown_34
                              - label:
                                  id: forecast_temperature_1
                                  <<: *forcast_label_base
                                  text: "--°"
                      - obj:
                          <<: *forcast_obj_base
                          grid_cell_row_pos: 0
                          grid_cell_column_pos: 2
                          widgets:
                              - label:
                                  id: forecast_timestamp_2
                                  <<: *forcast_label_base_sm
                                  text: ???
                              - image:
                                  id: forecast_condition_icon_2
                                  <<: *forcast_image_base
                                  src: unknown_34
                              - label:
                                  id: forecast_temperature_2
                                  <<: *forcast_label_base
                                  text: "--°"
                      - obj:
                          <<: *forcast_obj_base
                          grid_cell_row_pos: 0
                          grid_cell_column_pos: 3
                          widgets:
                              - label:
                                  id: forecast_timestamp_3
                                  <<: *forcast_label_base_sm
                                  text: ???
                              - image:
                                  id: forecast_condition_icon_3
                                  <<: *forcast_image_base
                                  src: unknown_34
                              - label:
                                  id: forecast_temperature_3
                                  <<: *forcast_label_base
                                  text: "--°"

packages:
  # header
  header_sensors: !include { file: widgets/header/sensors.yaml }
  # boot screen
  boot_screen_sensors: !include { file: widgets/boot_screen/sensors.yaml }
  # clock screen
  clock_screen_sensors: !include { file: pages/clock/sensors.yaml }
  # device status screen
  device_status_screen_sensors: !include { file: pages/status/sensors.yaml }
  # automatic screen control
  control_auto_display: !include { file: functions/control_auto_display.yaml }

  # Weather packages
  # Build icon set from .svg files
  weather_icons_34: !include
    file: weather/weather_icons.yaml
    vars:
      size: 34
  # Display weather forcast using icon set (defined above)
  weather_forcast_34: !include
    file: weather/weather_forecast.yaml
    vars:
      size: 34
  # Big icons for today weather
  weather_icons_60: !include
    file: weather/weather_icons.yaml
    vars:
      size: 60
  # Get todays weather and display it
  weather_today_60: !include
    file: weather/weather_today.yaml
    vars:
      size: 60
